<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>India's Plastic ‚Äî Do's & Don'ts (Enhanced Dashboard)</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- html2pdf (export) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <!-- Leaflet for map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    /* (Kept and simplified styles from earlier; still responsive and modern) */
    :root{
      --bg:#071021; --card:#0b1220; --muted:#9aa6b2; --accent:#06b6d4; --accent-2:#7c3aed; --glass:rgba(255,255,255,0.02);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    body{margin:0;padding:22px;background:linear-gradient(180deg,#071021 0%, #081126 60%);color:#e6eef6}
    .container{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 380px;gap:18px}
    header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}

    .card{background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    main{display:block}
    .overview{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .stats{display:flex;gap:12px;flex-wrap:wrap}
    .stat{flex:1;min-width:130px;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
    .chart-wrap{height:320px}
    .dispose-list{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    .dispose-item{padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    aside{display:block}
    .animals .animal{display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:10px;margin-bottom:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:10px 12px;border-radius:10px;border:none;color:#021024;font-weight:700;cursor:pointer}

    #map{height:280px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    .state-panel{display:flex;gap:8px;align-items:center;margin-top:10px}
    .chip{display:inline-block;padding:6px 8px;border-radius:999px;font-size:12px;margin-right:6px;background:rgba(255,255,255,0.03)}
    .small{font-size:13px;color:var(--muted)}

    @media (max-width:980px){
      .container{grid-template-columns:1fr;padding:12px}
      header{flex-direction:column;align-items:flex-start}
      .overview{grid-template-columns:1fr}
      .dispose-list{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="logo">PB</div>
        <div>
          <h1>India's Plastic ‚Äî Do's & Don'ts (Enhanced)</h1>
          <div class="subtitle">State-wise checker ‚Ä¢ Official stats ‚Ä¢ Export & Map</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="small">Last updated: <strong id="lastUpdated">--</strong></div>
        <button class="btn" id="exportBtn" title="Export to PDF">Export to PDF</button>
      </div>
    </header>

    <!-- Left (main) -->
    <main>
      <section class="card">
        <h2 style="margin:0 0 8px 0">Overview (official figures & context)</h2>
        <div class="small">Below are official CPCB numbers for plastic waste generation (tonnes/year, sample years). More recent academic estimates exist and are shown for context.</div>

        <div style="margin-top:12px" class="overview">
          <div>
            <div class="stats" style="margin-bottom:12px">
              <div class="stat">
                <h3>2016‚Äì17</h3>
                <p id="s2016">1,568,714 t</p>
              </div>
              <div class="stat">
                <h3>2017‚Äì18</h3>
                <p id="s2017">660,787 t</p>
              </div>
              <div class="stat">
                <h3>2018‚Äì19</h3>
                <p id="s2018">3,360,043 t</p>
              </div>
              <div class="stat">
                <h3>2019‚Äì20</h3>
                <p id="s2019">3,469,780 t</p>
              </div>
              <div class="stat">
                <h3>2020‚Äì21</h3>
                <p id="s2020">4,126,997 t</p>
              </div>
            </div>

            <div id="chartCard" class="card" style="padding:10px">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <h3 style="margin:0">Plastic Types & Trend</h3>
                  <div class="small">Stacked bars (by type) + total (trend)</div>
                </div>
                <div><span class="chip">Recyclable</span><span class="chip">Non-recyclable</span></div>
              </div>
              <div class="chart-wrap" style="margin-top:8px">
                <canvas id="plasticChart" aria-label="Plastic types chart" role="img"></canvas>
              </div>
            </div>
          </div>

          <div>
            <!-- State-wise checker -->
            <div class="card" style="margin-bottom:12px;">
              <h3 style="margin:0 0 6px 0">State-wise Ban Checker</h3>
              <div class="small">Select a state to view central and (sample) state-level notes. Replace sample data with official state notifications where available.</div>

              <div class="state-panel" style="margin-top:8px">
                <select id="stateSelect" style="flex:1;padding:8px;border-radius:8px;background:transparent;color:inherit;border:1px solid rgba(255,255,255,0.05)">
                  <!-- options populated by JS -->
                </select>
                <button class="btn" id="refreshState">Refresh</button>
              </div>

              <div id="stateInfo" style="margin-top:10px"></div>

              <div style="margin-top:10px" class="small">
                <strong>Central rule summary:</strong> Identified single-use plastic items are prohibited nationwide w.e.f <strong>1 July 2022</strong>. States/UTs may have additional restrictions. (See sources below in the dashboard footer.)
              </div>
            </div>

            <!-- Disposal / map -->
            <div class="card">
              <h3 style="margin:0 0 6px 0">Disposal map (sample authorised collection centres)</h3>
              <div class="small">Use your browser's geolocation or search to find nearby collection centres. Replace the `centers` array in the script with your own dataset (CSV/GeoJSON).</div>
              <div id="map"></div>
              <div style="margin-top:8px" class="small">Sample centres shown ‚Äî please replace with municipal / KaroSambhav / local NGO datasets for production. Example directory: KaroSambhav.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Practical do's/don'ts -->
      <section class="card" style="margin-top:12px">
        <h3 style="margin:0 0 8px 0">Practical Do's & Don'ts</h3>
        <ul style="margin:0;color:var(--muted);line-height:1.6;padding-left:18px">
          <li><strong style="color:#38b000">Do:</strong> segregate at source‚Äîwet, dry, recyclables & hazardous.</li>
          <li><strong style="color:#38b000">Do:</strong> join local take-back / EPR programs where available.</li>
          <li><strong style="color:#ef4444">Don't:</strong> dump plastic into drains, rivers, or open fields.</li>
          <li><strong style="color:#ef4444">Don't:</strong> burn plastics ‚Äî toxic emissions.</li>
        </ul>
      </section>
    </main>

    <!-- Right column -->
    <aside>
      <div class="card">
        <h3 style="margin:0 0 6px 0">Wildlife & Pets ‚Äî Quick Guide</h3>
        <div class="animals small">
          <div class="animal"><div style="font-size:22px">üêÑ</div><div><strong>Cow</strong><div class="small">Do: Keep grazing areas clean. Don't: Let animals ingest plastic-wrapped food.</div></div></div>
          <div class="animal"><div style="font-size:22px">üêò</div><div><strong>Elephant</strong><div class="small">Do: Support clean-ups near forest fringes. Don't: Leave ropes/bottles near corridors.</div></div></div>
          <div class="animal"><div style="font-size:22px">üê¢</div><div><strong>Turtle</strong><div class="small">Do: Use beach bins. Don't: Leave plastic film (turtles mistake it for jellyfish).</div></div></div>
          <div class="animal"><div style="font-size:22px">üêü</div><div><strong>Fish & Marine Life</strong><div class="small">Do: Keep drains plastic-free. Don't: Throw plastic near waterways.</div></div></div>
          <div class="animal"><div style="font-size:22px">üïäÔ∏è</div><div><strong>Birds</strong><div class="small">Do: Secure garbage; clip loose plastic. Don't: Leave food in wrappers.</div></div></div>
          <div class="animal"><div style="font-size:22px">üê∂</div><div><strong>Dogs</strong><div class="small">Do: Use covered bins. Don't: Discard food in plastic wrappers where dogs scavenge.</div></div></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3 style="margin:0 0 6px 0">Resources</h3>
        <ol style="margin:0;color:var(--muted);padding-left:18px;line-height:1.6">
          <li>Central rules & press releases (see footer).</li>
          <li>Find local collection centres from NGOs or municipal portals (sample: KaroSambhav).</li>
          <li>Consider integrating state notifications as JSON and keeping them updated.</li>
        </ol>
      </div>
    </aside>

    <footer style="grid-column:1/-1;margin-top:12px;display:flex;gap:12px;flex-wrap:wrap">
      <div class="card" style="flex:1">
        <strong>Notes & sources</strong>
        <div class="small" style="margin-top:6px">
          - Central single-use plastic ban effective 1 July 2022; CPCB lists items and provides implementation guidance. (See official press releases.)<br>
          - CPCB reports used for official generation figures (2016‚Äì17 through 2020‚Äì21). For broader academic estimates see recent publications (Nature 2024, policy reports).
        </div>
      </div>
      <div class="card small" style="width:340px">
        <strong>Cited sources (examples)</strong>
        <ul style="margin:8px 0 0 16px;line-height:1.5">
          <li><a href="#" id="link_cpcb" style="color:inherit">CPCB annual report / PWM press</a></li>
          <li><a href="#" id="link_pib" style="color:inherit">PIB press release: SUP ban (1 Jul 2022)</a></li>
          <li><a href="#" id="link_karo" style="color:inherit">KaroSambhav (collection centres)</a></li>
        </ul>
      </div>
    </footer>
  </div>

  <!-- JS -->
  <script>
    // ============== Utility & sources (for footer links) =================
    const sourceLinks = {
      cpcb: "https://cpcb.nic.in/uploads/plasticwaste/Annual_Report_2019-20_PWM.pdf",
      pib: "https://pib.gov.in/PressReleasePage.aspx?PRID=1837518",
      karo: "https://karosambhav.com/collection-centres",
      press_sup: "https://cpcb.nic.in/uploads/Press-release-SUP-ban-17062022.pdf",
      nature: "https://www.nature.com/articles/s41586-024-07758-6"
    };
    document.getElementById('link_cpcb').href = sourceLinks.cpcb;
    document.getElementById('link_pib').href = sourceLinks.pib;
    document.getElementById('link_karo').href = sourceLinks.karo;

    // Last updated stamp
    document.getElementById('lastUpdated').textContent = new Date().toLocaleString('en-IN', {dateStyle:'medium', timeStyle:'short'});

    // ============== Official sample numbers (CPCB) =======================
    // The CPCB annual report (sample) reports these figures; keep or replace with fresh JSON.
    const officialNumbers = {
      "2016-17": 1568714,
      "2017-18": 660787,
      "2018-19": 3360043,
      "2019-20": 3469780,
      "2020-21": 4126997
    };
    document.getElementById('s2016').textContent = officialNumbers["2016-17"].toLocaleString('en-IN') + ' t';
    document.getElementById('s2017').textContent = officialNumbers["2017-18"].toLocaleString('en-IN') + ' t';
    document.getElementById('s2018').textContent = officialNumbers["2018-19"].toLocaleString('en-IN') + ' t';
    document.getElementById('s2019').textContent = officialNumbers["2019-20"].toLocaleString('en-IN') + ' t';
    document.getElementById('s2020').textContent = officialNumbers["2020-21"].toLocaleString('en-IN') + ' t';

    // ============== Chart (same stacked + trend pattern as before) =========
    const years = Object.keys(officialNumbers);
    // sample breakdown by type (synthetic but plausible); replace with state/municipal data as available
    const sample = {
      types: {
        "Bottles": [12000,14000,15000,16000,18500],
        "Plastic Bags": [40000,38000,36000,35000,32000],
        "Film & Wraps": [18000,19000,19500,20000,21000],
        "Multilayer Pouches": [9000,10000,11000,12000,13000]
      }
    };
    const totals = years.map((_,i) => sample.types["Bottles"][i] + sample.types["Plastic Bags"][i] + sample.types["Film & Wraps"][i] + sample.types["Multilayer Pouches"][i]);

    const ctx = document.getElementById('plasticChart').getContext('2d');
    const plasticChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: years,
        datasets: [
          { label:'Bottles', data: sample.types["Bottles"], stack:'s1' },
          { label:'Plastic Bags', data: sample.types["Plastic Bags"], stack:'s1' },
          { label:'Film & Wraps', data: sample.types["Film & Wraps"], stack:'s1' },
          { label:'Multilayer Pouches', data: sample.types["Multilayer Pouches"], stack:'s1' },
          { label:'Total (trend)', data: totals, type:'line', yAxisID:'y1', borderWidth:2, fill:false, pointRadius:3, order:2 }
        ]
      },
      options: {
        responsive:true,
        interaction:{mode:'index', intersect:false},
        plugins:{legend:{position:'top'}},
        scales:{
          x:{stacked:true},
          y:{stacked:true, title:{display:true,text:'Tonnes (stacked)'}},
          y1:{position:'right', grid:{display:false}, ticks:{display:false}}
        },
        animation:{duration:1200,easing:'easeOutCubic'}
      }
    });

    // ============== State-wise checker (skeleton with sample notes) =========
    // IMPORTANT: This object is a SAMPLE. Replace each state's 'notes' value with official state notifications (PDF links/summary).
    const stateData = {
      "All India (Central rule)": {
        summary: "Central rule: Identified single-use plastic items are prohibited nationwide w.e.f 1 July 2022. States/UTs may add further restrictions.",
        link: sourceLinks.pib,
        items: ["Plastic sticks (earbuds etc.)","Straws","Cups/plates/cutlery","Certain lightweight carry bags (<120 microns after deadline)"],
        note: "Refer to central PWM Amendment rules & state pollution control boards for state-specific notifications."
      },
      "Maharashtra (sample)": {
        summary: "Maharashtra has state-level implementation guidelines and municipal-level directives in many cities. Check Maharashtra Pollution Control Board (MPCB) for details.",
        link: "https://mpcb.gov.in/",
        items: [],
        note: "Municipalities often enforce stricter rules; update here with official notification links."
      },
      "Delhi (sample)": {
        summary: "Delhi enforces central ban and has municipal fines for littering and burning. Check DPCC / MCD notices.",
        link: "https://www.dpccair.org/",
        items: [],
        note: "Local urban bodies carry enforcement responsibilities."
      },
      "Kerala (sample)": {
        summary:"Kerala often runs aggressive anti-plastic drives; check Kerala State Pollution Control Board for local notifications.",
        link:"https://www.keralapcb.nic.in/",
        items: [],
        note:"Some districts/municipalities have additional bans and active take-back programs."
      },
      "Odisha (example news item)": {
        summary:"Some districts in Odisha are declaring themselves single-use-plastic-free (example: Nuapada declared single-use plastic free per local reports). Replace with state notification if available.",
        link:"https://timesofindia.indiatimes.com/",
        items: [],
        note:"This is an example of district-level success; always confirm with state PCB."
      }
      // Add remaining states/UTs here; maintainers should store this JSON on a server for easy updates.
    };

    // Populate select UI
    const stateSelect = document.getElementById('stateSelect');
    Object.keys(stateData).forEach(k=>{
      const opt = document.createElement('option'); opt.value = k; opt.textContent = k;
      stateSelect.appendChild(opt);
    });
    const stateInfo = document.getElementById('stateInfo');

    function showState(name) {
      const d = stateData[name];
      let html = `<div style="padding:10px;border-radius:8px;background:rgba(255,255,255,0.01)"><strong>${name}</strong><div class="small" style="margin-top:8px">${d.summary}</div>`;
      if(d.items && d.items.length){
        html += `<div style="margin-top:8px"><strong>Notes / restricted items:</strong><ul style="margin:6px 0 0 16px">` + d.items.map(i=>`<li>${i}</li>`).join('') + `</ul></div>`;
      }
      html += `<div style="margin-top:8px" class="small">Reference: <a href="${d.link}" target="_blank" style="color:inherit">${d.link}</a></div>`;
      html += `</div>`;
      stateInfo.innerHTML = html;
    }
    // initial
    showState(Object.keys(stateData)[0]);
    document.getElementById('refreshState').addEventListener('click', ()=> showState(stateSelect.value));

    // ============== Map & sample collection centres (replace with your dataset) ============
    // Sample centers array - replace with your own GeoJSON or call an API
    const centers = [
      {id:1,name:"Sample Collection Centre - Delhi (NGO)",city:"New Delhi",coords:[28.644800,77.216721],notes:"Dry waste accepted; call before drop-off"},
      {id:2,name:"Recycling Hub - Mumbai (Recycler)",city:"Mumbai",coords:[19.075983,72.877655],notes:"Bottles & film; accepts segregated plastic"},
      {id:3,name:"Collection Point - Bengaluru (Local Ward)",city:"Bengaluru",coords:[12.971599,77.594566],notes:"Household collection on certain days"}
    ];

    // Initialize Leaflet map
    const map = L.map('map', { zoomControl:true }).setView([20.5937,78.9629], 5); // India center
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Add markers
    const markers = L.featureGroup();
    centers.forEach(c=>{
      const m = L.marker(c.coords).bindPopup(`<strong>${c.name}</strong><div class="small">${c.city}</div><div class="small">${c.notes}</div>`);
      markers.addLayer(m);
    });
    markers.addTo(map);
    map.fitBounds(markers.getBounds(), {padding:[40,40]});

    // Optional: geolocate button
    function tryGeolocate() {
      if(!navigator.geolocation){ alert('Geolocation not supported'); return; }
      navigator.geolocation.getCurrentPosition(pos=>{
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        map.setView([lat,lon],13);
        L.circle([lat,lon], {radius:200, color:'#06b6d4', fillOpacity:0.09}).addTo(map).bindPopup('You are here');
      }, err=>{
        console.warn(err); alert('Could not get location ‚Äî permission denied or unavailable.');
      }, {timeout:8000});
    }
    // add small button
    const geoBtn = L.control({position:'topright'});
    geoBtn.onAdd = function(){ const d = L.DomUtil.create('div',''); d.innerHTML = '<button title="Find my location" style="padding:6px;border-radius:6px;border:none;background:#ffffff22;color:inherit">üìç My location</button>'; d.firstChild.onclick = tryGeolocate; return d; }
    geoBtn.addTo(map);

    // ============== Export to PDF (html2pdf) ==========================
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      // html2pdf will render the full document; tweak options for quality/scale as needed
      const opt = {
        margin:0.4,
        filename: 'India-Plastic-Dashboard.pdf',
        image: { type:'jpeg', quality:0.95 },
        html2canvas: { scale: 1.25, useCORS: true },
        jsPDF: { unit:'in', format:'a4', orientation:'portrait' }
      };
      // Temporarily expand charts for better print quality (optional)
      html2pdf().set(opt).from(document.body).save();
    });

    // ============== Developer notes (inline) ============================
    // - To add real state-level rules: replace the `stateData` object with a server-fetched JSON (eg. /data/state_rules.json).
    // - To load real disposal centers: fetch a GeoJSON (municipal API or NGO directories) and build markers programmatically.
    // - To update official numbers: fetch CPCB CSV/JSON and call updateChart(newSample) (function inlined below for convenience).
    // - For large datasets, cluster Leaflet markers (Leaflet.markercluster) for performance.
    // - For production, host html2pdf and leaflet assets locally and secure any API keys.
  </script>
</body>
</html>
